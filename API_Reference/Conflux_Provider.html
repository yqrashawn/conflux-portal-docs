<!DOCTYPE html>
<html lang="en">
	<head>
		<title>ConfluxPortal</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="ConfluxPortal project documentation">
        <link rel="icon" type="image/png" href="https://www.conflux-chain.org/icons/icon-48x48.png">

        <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css" rel="stylesheet" type="text/css">
        <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css" rel="stylesheet" type="text/css">

        
            <link href="//cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet" type="text/css">
            <link href="//fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet" type="text/css">

            <style>
                * {
                    box-sizing: border-box;
                }

                html,
                body {
                    font-family: 'Roboto', sans-serif;
                }

                body {
                    display: flex;
                    flex-direction: column;
                    line-height: 1.6;
                }

                header {
                    border-bottom: 1px solid gainsboro;
                    box-shadow: -4px -4px 8px 1px grey;
                    display: flex;
                    flex-grow: 0;
                    flex-shrink: 0;
                    position: relative;
                    z-index: 1;
                }

                .content {
                    display: flex;
                    min-height: 100vh;
                }

                nav {
                    background-color: whitesmoke;
                    border-right: 1px solid gainsboro;
                    flex-grow: 0;
                    flex-shrink: 0;
                    padding: 24px;
                    position: relative;
                    width: 288px;
                }

                nav ul {
                    margin: 0;
                    padding: 0;
                }

                .scroll nav ul {
                    left: 24px;
                    position: fixed;
                    top: 24px;
                    width: calc(288px - 48px);
                }

                nav li {
                    list-style: none;
                }

                nav li a,
                nav .folder {
                    border-bottom: 0;
                    color: inherit;
                    text-transform: capitalize;
                }

                nav .indent {
                    margin-bottom: 1.4em;
                    margin-left: 12px;
                }

                nav ul > .indent {
                    margin-left: 0;
                }

                nav ul > .indent > li,
                nav ul > li {
                    font-weight: 700;
                }

                main {
                    flex: 1;
                    padding: 24px;
                }

                .container {
                    font-weight: 300;
                    margin: auto;
                    max-width: 800px;
                    position: relative;
                }

                .container > *:first-child {
                    margin-top: 0;
                    padding-top: 0;
                }

                .name {
                    flex-grow: 0;
                    flex-shrink: 0;
                    font-size: 24px;
                    font-weight: 700;
                    line-height: 24px;
                    padding: 24px 24px 24px 78px;
                    width: 288px;
                }

                .logo {
                    background-repeat: no-repeat;
                    background-size: contain;
                    display: inline-block;
                    height: 36px;
                    left: 24px;
                    position: absolute;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 36px;
                }

                .header-anchor {
                    border-bottom: 0;
                    color: inherit;
                    visibility: hidden;
                }

                *:hover > .header-anchor {
                    visibility: visible;
                }

                .feedback {
                    background-color: #E8E8E8;
                    border-radius: 3px;
                    bottom: 24px;
                    color: darkgray;
                    font-size: 12px;
                    left: 24px;
                    line-height: 1.6;
                    padding: 12px 12px 12px 54px;
                    position: fixed;
                    width: calc(288px - 48px);
                }

                .feedback a {
                    color: inherit;
                }

                .feedback i {
                    font-size: 32px;
                    left: 12px;
                    position: absolute;
                    top: 50%;
                    transform: translateY(-50%);
                }

                .actions {
                    align-items: center;
                    display: flex;
                    flex: 1;
                    justify-content: flex-end;
                    padding: 24px;
                }

                .actions a {
                    border-bottom: 0;
                    color: inherit;
                }

                .actions > * {
                    cursor: pointer;
                    height: 20px;
                    line-height: 20px;
                    margin-left: 20px;
                    text-align: center;
                    width: 20px;
                }

                .version {
                    color: darkgray;
                    font-size: 16px;
                }

                .expanded nav {
                    display: none;
                }

                .expanded .container {
                    max-width: 1200px;
                }

                #menu {
                    display: none;
                    z-index: 2;
                }

                .bottomMatter {
                    color: darkgray;
                    display: inline-block;
                    margin: 56px 0;
                    position: relative;
                    width: 100%;
                }

                #top {
                    cursor: pointer;
                    position: absolute;
                    right: 0;
                    top: 0;
                }

                @media (max-width: 800px) {
                    html,
                    body {
                        height: 100%;
                    }

                    main {
                        -webkit-overflow-scrolling: touch;
                        overflow: auto;
                        padding: 0;
                    }

                    header {
                        z-index: auto;
                    }

                    .content {
                        flex: 1;
                        min-height: 0;
                    }

                    .container {
                        padding: 12px;
                    }

                    #expando,
                    .version,
                    .pullrequest,
                    .help {
                        display: none;
                    }

                    #menu {
                        display: block;
                    }

                    nav {
                        border-left: 1px solid gainsboro;
                        border-right: 0;
                        box-shadow: 4px 4px 9px 1px grey;
                        display: block !important;
                        height: 100%;
                        max-width: calc(100vw - 48px);
                        position: fixed;
                        right: 0;
                        top: 0;
                        transform: translateX(100%);
                        transition: transform ease-out 0.2s;
                        z-index: 1;
                    }

                    nav ul {
                        position: static;
                        width: 100%;
                    }

                    .actions {
                        flex-grow: 0;
                        flex-shrink: 0;
                        padding: 12px;
                    }

                    .menu nav {
                        transform: translateX(0);
                    }

                    .name {
                        flex: 1;
                        font-size: 18px;
                        padding: 12px 12px 12px 54px;
                        width: auto;
                        word-break: break-word;
                    }

                    .logo {
                        height: 24px;
                        left: 12px;
                        width: 24px;
                    }
                }

                /* Markdown styles */
                blockquote {
                    border-left: 4px solid gainsboro;
                    margin-left: 0;
                    padding-left: 1em;
                    padding-right: 1em;
                }

                table {
                    border-collapse: collapse;
                }

                table th,
                table td {
                    border: 1px solid gainsboro;
                    padding: 4px 8px;
                }

                table tbody tr:nth-child(even) {
                    background: whitesmoke;
                }

                code {
                    background-color: whitesmoke !important;
                    border-radius: 3px !important;
                    font-size: 85% !important;
                    padding: 4px !important;
                }

                .hljs {
                    padding: 8px !important;
                }

                a {
                    border-bottom: 1px solid;
                    color: dodgerblue;
                    text-decoration: none;
                }

                .contains-task-list {
                    list-style: none;
                    padding-left: 18px;
                }

                .task-list-item-checkbox {
                    margin-right: 4px;
                }
            </style>
        
        
	</head>
	<body>
        <header>
            <div class="name">
                <div class="logo" style="background-image: url(https://www.conflux-chain.org/icons/icon-48x48.png)"></div>
                ConfluxPortal
                <span class="version"></span>
            </div>
            <div class="actions">
                <a href="/conflux-portal-docs/" class="help">
                    <i class="fa fa-home" aria-hidden="true"></i>
                </a>
                
                    <a href="https://github.com/Conflux-Chain/conflux-portal" class="pullrequest">
                        <i class="fa fa-pencil" aria-hidden="true"></i>
                    </a>
                
                <i class="fa fa-plus-square" aria-hidden="true" id="expando"></i>
                <i class="fa fa-bars" aria-hidden="true" id="menu"></i>
            </div>
        </header>
        <div class="content">
            <nav>
                <ul>
                    <li>
                        <a href="/conflux-portal-docs/">home</a>
                    </li>
                    
                    
                        <div class="indent">
                            
                                
                                    
                                        <li>
                                            <div class="folder">Differences With MetaMask</div>
                                        </li>
                                        
                        <div class="indent">
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Differences_With_MetaMask/Injected_Name_Space">Injected Name Space</a>
                                    </li>
                                
                            
                        </div>
                    
                                    
                                    
                                
                                    
                                        <li>
                                            <div class="folder">Examples</div>
                                        </li>
                                        
                        <div class="indent">
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Examples/Low_Level_CFX_Transfer">Low Level CFX Transfer</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Examples/E2E_Tets_Dapp">E2E Tets Dapp</a>
                                    </li>
                                
                            
                        </div>
                    
                                    
                                    
                                
                                    
                                        <li>
                                            <div class="folder">Main Concepts</div>
                                        </li>
                                        
                        <div class="indent">
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Main_Concepts/Getting_Started">Getting Started</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Main_Concepts/Common_Terms">Common Terms</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Main_Concepts/Initializing_Dapps">Initializing Dapps</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Main_Concepts/Accessing_Accounts">Accessing Accounts</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Main_Concepts/Sending_Transactions">Sending Transactions</a>
                                    </li>
                                
                            
                        </div>
                    
                                    
                                    
                                
                                    
                                        <li>
                                            <div class="folder">API Reference</div>
                                        </li>
                                        
                        <div class="indent">
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Conflux_Provider">Conflux Provider</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/JSON_RPC_API">JSON RPC API</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Experimental_APIs">Experimental APIs</a>
                                    </li>
                                
                            
                                
                                    
                                        <li>
                                            <div class="folder">Signing Data</div>
                                        </li>
                                        
                        <div class="indent">
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Signing_Data/Introduction">Introduction</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Signing_Data/CFX_Sign">CFX Sign</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Signing_Data/Personal_Sign">Personal Sign</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Signing_Data/Sign_Typed_Data_v1">Sign Typed Data v1</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Signing_Data/Sign_Typed_Data_v3">Sign Typed Data v3</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/API_Reference/Signing_Data/Sign_Typed_Data_v4">Sign Typed Data v4</a>
                                    </li>
                                
                            
                        </div>
                    
                                    
                                    
                        </div>
                    
                                    
                                    
                                
                                    
                                        <li>
                                            <div class="folder">Best Practices</div>
                                        </li>
                                        
                        <div class="indent">
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Best_Practices/Registering_Function_Names">Registering Function Names</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Best_Practices/Registering_Your_Token">Registering Your Token</a>
                                    </li>
                                
                            
                                
                                
                                    <li>
                                        <a href="/conflux-portal-docs/Best_Practices/Defining_Your_Icon">Defining Your Icon</a>
                                    </li>
                                
                            
                        </div>
                    
                                    
                                    
                                
                                
                            
                        </div>
                    
                </ul>
                
                    <div class="feedback">
                        <i class="fa fa-bug" aria-hidden="true"></i>
                        Found a documentation bug?<br>
                        <a href="https://github.com/Conflux-Chain/conflux-portal/issues/new">File an issue</a>
                    </div>
                
            </nav>
            <main>
                <div class="container">
                    <h1 id="conflux-provider-api">Conflux Provider API <a class="header-anchor" href="#conflux-provider-api">#</a></h1>
<p>ConfluxPortal injects a global API into websites visited by its users at
<code>window.conflux</code>. This API allows websites to request user login, load data from
blockchains the user has a connection to, and suggest that the user sign
messages and transactions. You can use this API to detect the user of an Conflux
browser.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>.conflux !== <span class="hljs-string">'undefined'</span>) {

  <span class="hljs-comment">// Conflux user detected. You can now use the provider.</span>
  <span class="hljs-keyword">const</span> provider = <span class="hljs-built_in">window</span>[<span class="hljs-string">'conflux'</span>]
}
</code></pre>
<p>The provider API itself is very simple, and wraps <a href="./JSON_RPC_API">Conflux
JSON-RPC</a> formatted messages, which is why developers usually
use a convenience library for interacting with the provider, like
<a href="https://www.npmjs.com/package/js-conflux-sdk">js-conflux-sdk</a>,
<a href="https://github.com/liuis/conffle#readme">conffle</a>, or others. From those tools,
you can generally find sufficient documentation to interact with the provider,
without reading this lower-level API.</p>
<p>However, for developers of convenience libraries, and for developers who would
like to use features that are not yet supported by their favorite libraries,
knowledge of the provider API is essential.</p>
<h3 id="upcoming-provider-changes">Upcoming Provider Changes <a class="header-anchor" href="#upcoming-provider-changes">#</a></h3>
<p>In early 2020, we will be introducing some changes changes to this API, and
beginning to deprecate some old synchronous methods. You can <a href="https://medium.com/metamask/breaking-changes-to-the-metamask-inpage-provider-b4dde069dd0a">read more about
that transition
here</a>.</p>
<p>We will begin supporting the new API in early 2020. AWe will support the old and
new APIs for at least 6 weeks, after which some of the older methods will be
deprecated. These changes will make the ConfluxPortal inpage provider fully
compatible with <a href="https://github.com/conflux/EIPs/blob/master/EIPS/eip-1193.md">EIP
1193</a> and <a href="https://github.com/conflux/EIPs/blob/master/EIPS/eip-1102.md">EIP
1102</a>.</p>
<p>You can continue reading to learn about the current API. Otherwise, <a href="#new-api">click here
to learn about the upcoming API changes</a>.</p>
<h3 id="a-note-on-language">A Note on Language <a class="header-anchor" href="#a-note-on-language">#</a></h3>
<p>In our usage, if a feature is <em>deprecated</em>, we strongly discourage its use, and
may remove it in the future. Features that will be <em>removed</em> or <em>replaced</em> on a
particular date are clearly marked as such. We do not anticipate any need for
further breaking changes after Q1 2020.</p>
<h1 id="current-api">Current API <a class="header-anchor" href="#current-api">#</a></h1>
<h2 id="properties">Properties <a class="header-anchor" href="#properties">#</a></h2>
<p>These properties can be used to check the current state of the connected user,
which can be important things to verify before sending a transaction.</p>
<h3 id="conflux.networkversion">conflux.networkVersion <a class="header-anchor" href="#conflux.networkversion">#</a></h3>
<p>Returns a numeric string representing the current blockchain’s network ID. A few
example values:</p>
<pre><code class="hljs language-javascript"><span class="hljs-string">'1'</span>: Conflux Main Network
<span class="hljs-string">'2'</span>: Conflux Test network
</code></pre>
<h3 id="conflux.selectedaddress">conflux.selectedAddress <a class="header-anchor" href="#conflux.selectedaddress">#</a></h3>
<p>Returns a hex-prefixed string representing the current user’s selected address,
ex: <code>&quot;0xfdea65c8e26263f6d9a1b5de9555d2931a33b825&quot;</code>.</p>
<h3 id="conflux.isconfluxportal">conflux.isConfluxPortal <a class="header-anchor" href="#conflux.isconfluxportal">#</a></h3>
<p>Returns <code>true</code> or <code>false</code>, representing whether the user has ConfluxPortal
installed.</p>
<h2 id="methods">Methods <a class="header-anchor" href="#methods">#</a></h2>
<h3 id="conflux.enable()">conflux.enable() <a class="header-anchor" href="#conflux.enable()">#</a></h3>
<p>Requests the user provides an conflux address to be identified by. Returns a
promise of an array of hex-prefixed conflux address strings.</p>
<h4 id="example-(es6)">Example (ES6) <a class="header-anchor" href="#example-(es6)">#</a></h4>
<p>Using an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">async
function</a>.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> accounts = <span class="hljs-keyword">await</span> conflux.enable()
  <span class="hljs-comment">// You now have an array of accounts!</span>
  <span class="hljs-comment">// Currently only ever one:</span>
  <span class="hljs-comment">// ['0xFDEa65C8e26263F6d9A1B5de9555D2931A33b825']</span>

} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-comment">// Handle error. Likely the user rejected the login</span>
  <span class="hljs-built_in">console</span>.error(error)
}
</code></pre>
<h4 id="example-(es5)">Example (ES5) <a class="header-anchor" href="#example-(es5)">#</a></h4>
<pre><code class="hljs language-javascript">conflux.enable()
.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">accounts</span>) </span>{
  <span class="hljs-comment">// You now have an array of accounts!</span>
  <span class="hljs-comment">// Currently only ever one:</span>
  <span class="hljs-comment">// ['0xFDEa65C8e26263F6d9A1B5de9555D2931A33b825']</span>
})
.catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
  <span class="hljs-comment">// Handle error. Likely the user rejected the login</span>
  <span class="hljs-built_in">console</span>.error(error)
})
</code></pre>
<h3 id="conflux.send(options%2C-callback)-(to-be-replaced)">conflux.send(options, callback) (To Be Replaced) <a class="header-anchor" href="#conflux.send(options%2C-callback)-(to-be-replaced)">#</a></h3>
<p><em>This will be replaced with <code>conflux.send(method: string, params: Array&lt;any&gt;)</code>
on <strong>January 13, 2020</strong>.</em> <em><a href="https://github.com/Conflux-Chain/conflux-portal-docs/blob/new-provider/03_API_Reference/01_Conflux_Provider.md#confluxsendmethod-string-params-array">Click
here</a>
for more information.</em></p>
<p>See <code>conflux.sendAsync</code>, directly below.</p>
<h3 id="conflux.sendasync(options%2C-callback)">conflux.sendAsync(options, callback) <a class="header-anchor" href="#conflux.sendasync(options%2C-callback)">#</a></h3>
<p><em>To be superceded by the promise-returning send() method in <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1193.md">EIP
1193</a>.</em></p>
<p>Sends a message to the web3 browser. Message format maps to the format of <a href="https://conflux-chain.github.io/conflux-doc/json-rpc/">the
Conflux JSON-RPC
API</a>.</p>
<p>Here’s an example of everyone’s favorite method, <code>cfx_sendTransaction</code>, which is
both how Ether is sent, and how smart contract methods are called:</p>
<pre><code class="hljs language-javascript">params: [{
  <span class="hljs-string">"from"</span>: <span class="hljs-string">"0xb60e8dd61c5d32be8058bb8eb970870f07233155"</span>,
  <span class="hljs-string">"to"</span>: <span class="hljs-string">"0xd46e8dd67c5d32be8058bb8eb970870f07244567"</span>,
  <span class="hljs-string">"gas"</span>: <span class="hljs-string">"0x76c0"</span>, <span class="hljs-comment">// 30400</span>
  <span class="hljs-string">"gasPrice"</span>: <span class="hljs-string">"0x9184e72a000"</span>, <span class="hljs-comment">// 10000000000000</span>
  <span class="hljs-string">"value"</span>: <span class="hljs-string">"0x9184e72a"</span>, <span class="hljs-comment">// 2441406250</span>
  <span class="hljs-string">"data"</span>: <span class="hljs-string">"0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675"</span>
}]

conflux.sendAsync({
  <span class="hljs-attr">method</span>: <span class="hljs-string">'cfx_sendTransaction'</span>,
  <span class="hljs-attr">params</span>: params,
  <span class="hljs-attr">from</span>: accounts[<span class="hljs-number">0</span>], <span class="hljs-comment">// Provide the user's account to use.</span>
}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, result</span>) </span>{
  <span class="hljs-comment">// A typical node-style, error-first callback.</span>
  <span class="hljs-comment">// The result varies by method, per the JSON RPC API.</span>
  <span class="hljs-comment">// For example, this method will return a transaction hash on success.</span>
})
</code></pre>
<h3 id="conflux.autorefreshonnetworkchange-(to-be-removed)">conflux.autoRefreshOnNetworkChange (To Be Removed) <a class="header-anchor" href="#conflux.autorefreshonnetworkchange-(to-be-removed)">#</a></h3>
<p><em>This will be removed on January 13, 2020. At this time, ConfluxPortal will also
stop reloading the page on network changes.</em> <em><a href="https://medium.com/metamask/no-longer-reloading-pages-on-network-change-fbf041942b44">Click
here</a>
for more details.</em></p>
<p>When the network is changed, ConfluxPortal will reload any pages that have made
requests to the provider. This automatic reload behavior will be removed in a
future release of ConfluxPortal, but in the meantime it can be disabled with
this flag.</p>
<p>To disable auto-refresh on a network change you can do:</p>
<pre><code class="hljs language-javascript">conflux.autoRefreshOnNetworkChange = <span class="hljs-literal">false</span>;
</code></pre>
<p>This can be toggled on or off at any time.</p>
<p><strong>Note:</strong> Setting this flag to <code>true</code> results in the default behavior, which is
subject to change. If your site relies upon ConfluxPortal reloading it upon
network change, you will need to trigger the reload yourself in a
<code>networkChanged</code> event handler to ensure it continues to work with future
releases.</p>
<h3 id="conflux.on(eventname%2C-callback)">conflux.on(eventName, callback) <a class="header-anchor" href="#conflux.on(eventname%2C-callback)">#</a></h3>
<p>The provider supports listening for some events:</p>
<ul>
<li><code>accountsChanged</code>, returns updated account array.</li>
<li><code>networkChanged</code>, returns network ID string.</li>
</ul>
<h4 id="example">Example <a class="header-anchor" href="#example">#</a></h4>
<pre><code class="hljs language-javascript">conflux.on(<span class="hljs-string">'accountsChanged'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">accounts</span>) </span>{
  <span class="hljs-comment">// Time to reload your interface with accounts[0]!</span>
})
</code></pre>
<p><strong>Note:</strong> At the moment, the <code>networkChanged</code> event is only useful if you
disable auto-refresh on network change by setting
<a href="#conflux.autorefreshonnetworkchange"><code>conflux.autoRefreshOnNetworkChange</code></a> to
<code>false</code>. Otherwise, ConfluxPortal will default to auto-reloading pages upon
network change if they have made requests to the provider. <em>ConfluxPortal will
stop reloading pages on network change on January 13, 2020, and this setting
will be removed.</em> <em><a href="https://medium.com/metamask/no-longer-reloading-pages-on-network-change-fbf041942b44">Click
here</a>
for more details.</em></p>
<h1 id="new-api">New API <a class="header-anchor" href="#new-api">#</a></h1>
<p>This API will become available during the week of <strong>November 25, 2019</strong>. It will
be the only API supported starting <strong>January 13, 2020.</strong> If you want examples of
how to setup your dapp using the new API, you can check out <a href="https://gist.github.com/rekmarks/d318677c8fc89e5f7a2f526e00a0768a">this
gist</a>.</p>
<h2 id="methods-2">Methods <a class="header-anchor" href="#methods-2">#</a></h2>
<h3 id="conflux.send(%E2%80%98cfx_requestaccounts%E2%80%99)">conflux.send(‘cfx_requestAccounts’) <a class="header-anchor" href="#conflux.send(%E2%80%98cfx_requestaccounts%E2%80%99)">#</a></h3>
<h4 id="conflux.enable()-(deprecated)">conflux.enable() (Deprecated) <a class="header-anchor" href="#conflux.enable()-(deprecated)">#</a></h4>
<p>Requests that the user provides an conflux address to be identified by. Returns
a promise of an array of hex-prefixed conflux address strings. See <a href="https://github.com/conflux/EIPs/blob/master/EIPS/eip-1102.md">EIP
1102</a> for more
details.</p>
<h4 id="example-(es6)-2">Example (ES6) <a class="header-anchor" href="#example-(es6)-2">#</a></h4>
<p>Using an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">async
function</a>.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> accounts = <span class="hljs-keyword">await</span> conflux.send(<span class="hljs-string">'cfx_requestAccounts'</span>)
  <span class="hljs-comment">// You now have an array of accounts!</span>
  <span class="hljs-comment">// Currently only ever one:</span>
  <span class="hljs-comment">// ['0xFDEa65C8e26263F6d9A1B5de9555D2931A33b825']</span>

} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-keyword">if</span> (error.code === <span class="hljs-number">4001</span>) { <span class="hljs-comment">// EIP 1193 userRejectedRequest error</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Please connect to ConfluxPortal.'</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">console</span>.error(error)
  }
}
</code></pre>
<h4 id="example-(es5)-2">Example (ES5) <a class="header-anchor" href="#example-(es5)-2">#</a></h4>
<pre><code class="hljs language-javascript">conflux.send(<span class="hljs-string">'cfx_requestAccounts'</span>)
.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">accounts</span>) </span>{
  <span class="hljs-comment">// You now have an array of accounts!</span>
  <span class="hljs-comment">// Currently only ever one:</span>
  <span class="hljs-comment">// ['0xFDEa65C8e26263F6d9A1B5de9555D2931A33b825']</span>
})
.catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
  <span class="hljs-keyword">if</span> (error.code === <span class="hljs-number">4001</span>) { <span class="hljs-comment">// EIP 1193 userRejectedRequest error</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Please connect to ConfluxPortal.'</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">console</span>.error(error)
  }
})
</code></pre>
<h3 id="conflux.send(method%3A-string%2C-params%3A-array)">conflux.send(method: string, params: Array<any>) <a class="header-anchor" href="#conflux.send(method%3A-string%2C-params%3A-array)">#</a></h3>
<p>The way to send requests to the dapp browser. <code>method</code> and <code>params</code> should
follow <a href="https://github.com/conflux/wiki/wiki/JSON-RPC#json-rpc-methods">the Conflux JSON-RPC
API</a>.</p>
<p>Returns a <code>Promise</code> that resolves to the result of the method. Not all methods
require <code>params</code>, e.g. <code>conflux.send('cfx_accounts')</code>.</p>
<p>Here’s an example of everyone’s favorite method, <code>cfx_sendTransaction</code>, which is
both how Ether is sent, and how smart contract methods are called:</p>
<pre><code class="hljs language-javascript">params: [{
  <span class="hljs-string">"from"</span>: <span class="hljs-string">"0xb60e8dd61c5d32be8058bb8eb970870f07233155"</span>,
  <span class="hljs-string">"to"</span>: <span class="hljs-string">"0xd46e8dd67c5d32be8058bb8eb970870f07244567"</span>,
  <span class="hljs-string">"gas"</span>: <span class="hljs-string">"0x76c0"</span>, <span class="hljs-comment">// 30400</span>
  <span class="hljs-string">"gasPrice"</span>: <span class="hljs-string">"0x9184e72a000"</span>, <span class="hljs-comment">// 10000000000000</span>
  <span class="hljs-string">"value"</span>: <span class="hljs-string">"0x9184e72a"</span>, <span class="hljs-comment">// 2441406250</span>
  <span class="hljs-string">"data"</span>: <span class="hljs-string">"0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675"</span>
}]

conflux.send(<span class="hljs-string">'cfx_sendTransaction'</span>, params)
.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) </span>{
  <span class="hljs-comment">// The result varies by method, per the JSON RPC API.</span>
  <span class="hljs-comment">// For example, this method will return a transaction hash on success.</span>
})
.catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
 <span class="hljs-comment">// Like a typical promise, returns an error on rejection.</span>
})
</code></pre>
<h3 id="conflux.on(eventname%2C-callback)-2">conflux.on(eventName, callback) <a class="header-anchor" href="#conflux.on(eventname%2C-callback)-2">#</a></h3>
<p>The provider supports listening for all events specified in <a href="https://github.com/conflux/EIPs/blob/master/EIPS/eip-1193.md#events">EIP
1193</a>.</p>
<p>The following are especially important for managing the state of your dapp:</p>
<ul>
<li><code>accountsChanged</code>, returns an array of the currently available accounts.</li>
<li><code>chainChanged</code>, returns the hex-formatted chain ID string of the currently
used chain/network.</li>
<li><code>networkChanged</code>, <em>(Discouraged)</em> returns decimal-formatted network ID string
of the currently used chain/network.</li>
</ul>
<h4 id="example-2">Example <a class="header-anchor" href="#example-2">#</a></h4>
<pre><code class="hljs language-javascript">conflux.on(<span class="hljs-string">'accountsChanged'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">accounts</span>) </span>{
  <span class="hljs-comment">// Time to reload your interface with accounts[0]!</span>
})

conflux.on(<span class="hljs-string">'chainChanged'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chainId</span>) </span>{
  <span class="hljs-comment">// Time to make sure your any calls are directed to the correct chain!</span>
})
</code></pre>
<h4 id="list-of-chain-and-network-ids">List of Chain and Network IDs <a class="header-anchor" href="#list-of-chain-and-network-ids">#</a></h4>
<pre><code class="hljs language-javascript"><span class="hljs-string">'1'</span>: Conflux Main Network
<span class="hljs-string">'2'</span>: Conflux Test network
</code></pre>
<h3 id="conflux.sendasync(options%2C-callback)-(deprecated)">conflux.sendAsync(options, callback) (Deprecated) <a class="header-anchor" href="#conflux.sendasync(options%2C-callback)-(deprecated)">#</a></h3>
<p><em>We strongly discourage the use of this method, which may be removed in the
future.</em></p>
<p>Sends a message to the dapp browser. Message format maps to the format of <a href="https://conflux-chain.github.io/conflux-doc/json-rpc/">the
Conflux JSON-RPC
API</a>.</p>
<p>Here’s an example of everyone’s favorite method, <code>cfx_sendTransaction</code>, which is
both how Ether is sent, and how smart contract methods are called:</p>
<pre><code class="hljs language-javascript">params: [{
  <span class="hljs-string">"from"</span>: <span class="hljs-string">"0xb60e8dd61c5d32be8058bb8eb970870f07233155"</span>,
  <span class="hljs-string">"to"</span>: <span class="hljs-string">"0xd46e8dd67c5d32be8058bb8eb970870f07244567"</span>,
  <span class="hljs-string">"gas"</span>: <span class="hljs-string">"0x76c0"</span>, <span class="hljs-comment">// 30400</span>
  <span class="hljs-string">"gasPrice"</span>: <span class="hljs-string">"0x9184e72a000"</span>, <span class="hljs-comment">// 10000000000000</span>
  <span class="hljs-string">"value"</span>: <span class="hljs-string">"0x9184e72a"</span>, <span class="hljs-comment">// 2441406250</span>
  <span class="hljs-string">"data"</span>: <span class="hljs-string">"0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675"</span>
}]

conflux.sendAsync({
  <span class="hljs-attr">method</span>: <span class="hljs-string">'cfx_sendTransaction'</span>,
  <span class="hljs-attr">params</span>: params,
  <span class="hljs-attr">from</span>: accounts[<span class="hljs-number">0</span>], <span class="hljs-comment">// Provide the user's account to use.</span>
}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, result</span>) </span>{
  <span class="hljs-comment">// A typical node-style, error-first callback.</span>
  <span class="hljs-comment">// The result varies by method, per the JSON RPC API.</span>
  <span class="hljs-comment">// For example, this method will return a transaction hash on success.</span>
})
</code></pre>
<h2 id="properties-2">Properties <a class="header-anchor" href="#properties-2">#</a></h2>
<p>Useful for knowing whether <code>window.conflux</code> is ConfluxPortal, but not much else.</p>
<h3 id="conflux.isconfluxportal-2">conflux.isConfluxPortal <a class="header-anchor" href="#conflux.isconfluxportal-2">#</a></h3>
<p><code>true</code> if the user has ConfluxPortal installed, <code>false</code> otherwise.</p>
<h3 id="conflux.networkversion-(deprecated)">conflux.networkVersion (Deprecated) <a class="header-anchor" href="#conflux.networkversion-(deprecated)">#</a></h3>
<p><em>We strongly discourage the use of this property, which may be removed in the
future.</em></p>
<p>Returns a numeric string representing the current blockchain’s network ID. A few
example values:</p>
<pre><code class="hljs language-javascript"><span class="hljs-string">'1'</span>: Conflux Main Network
<span class="hljs-string">'2'</span>: Conflux Test network
</code></pre>
<h3 id="conflux.selectedaddress-(deprecated)">conflux.selectedAddress (Deprecated) <a class="header-anchor" href="#conflux.selectedaddress-(deprecated)">#</a></h3>
<p><em>We strongly discourage the use of this property, which may be removed in the
future.</em></p>
<p>Returns a hex-prefixed string representing the current user’s selected address,
ex: <code>&quot;0xfdea65c8e26263f6d9a1b5de9555d2931a33b825&quot;</code>.</p>

                    <div class="bottomMatter">
                        Last updated:
                        
                        1/20/2020
                        <span id="top">Top <i class="fa fa-arrow-up" aria-hidden="true"></i></span>
                    </div>
                </div>
            </main>
        </div>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        <script>
            const header = document.querySelector('header');
            const main = document.querySelector('main');
            function onScroll() {
                document.body.classList.toggle('scroll', document.documentElement.scrollTop > header.offsetHeight);
            }
            window.addEventListener('scroll', onScroll);
            onScroll();

            document.querySelector('#expando').addEventListener('click', ({ target }) => {
                const expanded = target.classList.contains('fa-minus-square');
                target.classList.toggle('fa-minus-square', !expanded);
                target.classList.toggle('fa-minus-plus', expanded);
                document.body.classList.toggle('expanded', !expanded);
            });

            document.querySelector('#menu').addEventListener('click', ({ target }) => {
                const open = target.classList.contains('fa-times');
                target.classList.toggle('fa-times', !open);
                target.classList.toggle('fa-bars', open);
                document.body.classList.toggle('menu', !open);
            });

            document.querySelector('#top').addEventListener('click', () => {
                document.documentElement.scrollTo(0, 0);
                main.scrollTo(0, 0);
            });
        </script>
	</body>
</html>


